<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>SweetFeedback</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">


    <!-- Le styles -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    

    <!--<link href="assets/css/docs.css" rel="stylesheet">-->
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="assets/ico/favicon.png">

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#"><img src="img/logo.png" width="24px" id="logo"/>SweetFeedback</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="#about">About</a></li>

              <li class="dropdown" id="login">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#login">
                  Login
                  <b class="caret"></b>
                </a>
                <div class="dropdown-menu">
                  <form>
                    <fieldset class='textbox' style="padding:10px">
                      <input id="account" style="margin-top: 8px" type="text" placeholder="Account" name="account"/>
                      <input id="password" style="margin-top: 8px" type="password" placeholder="Passsword" name="password"/>
                      <a class="btn btn-primary" id="loginBt">Log In</a>
                    </fieldset>
                  </form>
                </div>
              </li>
              
              <li><a id="current_user"></a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">
      <h1 class="title">Sustainability Base Building</h1>


      
      

      <div id="left">
        <div class="building"><img src="img/building/building-1.png"/></div>
        <img id="" src="img/building/win1.png" style="margin-left: -486px; margin-top: 174px;"/>
        <img id="" src="img/building/win2.png" style="margin-left: -27px; margin-top: 143px;"/>
        <img id="" src="img/building/win3.png" style="margin-left: -25px; margin-top: 114px;"/>
        <img id="" src="img/building/win4.png" style="margin-left: -26px; margin-top: 85px;"/>
        <img id="" src="img/building/win5.png" style="margin-left: -26px; margin-top: 57px;"/>
        <div id="" class="building"><img src="img/building/building-2.png"/></div>

      </div>
      

      <div id="right">

        <div id="report" class="modal hide fade">

          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h3>Report a Problem!</h3>
          </div>
          
          <div class="modal-body">
            <form>
              <fieldset class='textbox' style="padding:10px">
                <input id="problemInput" style="margin-top: 8px" type="text" placeholder="Problem"/>
                <a class="btn btn-primary" id="reportSubmit" data-dismiss="modal">Submit</a>
              </fieldset>
            </form>
          </div>

          <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal" >Close</a>
          </div>

        </div>
        <a data-toggle="modal" href="#report" class="btn btn-primary">Report a Problem!</a>

        <div id="problemArea">
          <h4>Problem List</h4>
          <div id="problemList"><ul class="items"></ul></div>
          <div id="problemDetail"></div>
        </div>    
      </div>
      <!--      
      <div class="machine_status">
        <img src="img/mrc/mrc_happy.png"/><span id="machine_count">X 0</span>
      </div>
      -->
      <div class="machine">
        <img src="img/mrc/mrc_happy.png" width="50px"/>
        <img src="img/others/char-headphone.png" width="65px" style="margin-top: -128px; margin-left: -6px;"/>
      </div>
      <div class="machine">
        <img src="img/mrc/mrc_happy.png" width="50px"/>
        <img src="img/others/char-headphone.png" width="65px" style="margin-top: -128px; margin-left: -6px;"/>
      </div>
      <!--
      <div class="machine">
        <img src="img/mrc/mrc_sad.png" width="50px"/>  
        <img src="img/logo_b.png" width="50px"/>
      </div>-->
      <section id="monitor"></section>
      <section id="transportation"></section>




    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap-transition.js"></script>
    <script src="assets/js/bootstrap-alert.js"></script>
    <script src="assets/js/bootstrap-modal.js"></script>
    <script src="assets/js/bootstrap-dropdown.js"></script>
    <script src="assets/js/bootstrap-scrollspy.js"></script>
    <script src="assets/js/bootstrap-tab.js"></script>
    <script src="assets/js/bootstrap-tooltip.js"></script>
    <script src="assets/js/bootstrap-popover.js"></script>
    <script src="assets/js/bootstrap-button.js"></script>
    <script src="assets/js/bootstrap-collapse.js"></script>
    <script src="assets/js/bootstrap-carousel.js"></script>
    <script src="assets/js/bootstrap-typeahead.js"></script>
    <script src="assets/js/jquery.cookie.js"></script>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script>

    

    <script language="javascript">
      function updateMachineStatus(){
        alert("update!");
      }

      function readProblemList(){
        $('#problemList .items').empty();
        $.ajax({
          type: "GET",
          url: "http://localhost/~janetyc/GumballServer/php/getExistReports.php",
          dataType: 'json',
          success: function(data) {
            
            $.each(data, function(i, item) {
              $('#problemList .items').append('<li><a data-toggle="modal" href="#problem_'+item.id+'">'+item.title+'</a></li>');
              
              var problemDiv = $("<div></div>").attr('id','problem_'+item.id).addClass('modal hide fade');
              var problemBody = $('<div></div>').addClass('modal-body').appendTo(problemDiv);
              
              problemBody.append('<button type="button" class="close" data-dismiss="modal">&times;</button>');
              problemBody.append("<h3>Problem: "+item.title+"</h3>");
              problemBody.append('<span style="margin-left: 5px;">Create at '+item.created_at+'</span>');
              problemDiv.append('<div class="modal-footer"><a href="#" class="btn" data-dismiss="modal" >Close</a></div>');
              problemDiv.appendTo('#problemDetail');
              
            });
          },
          error: function(XMLHttpRequest, textStatus, errorThrown) {
            alert("Error");               
          }
        });
      }
      $(function(){

        /* log in stuff */
        var cur_user = "test";
        var cur_token;
        var cur_uid = 0;

        if($.cookie("sweetpassword")!=null){
          cur_uid = $.cookie("sweetuid");
          cur_item.id$.cookie("sweetaccount");
          cur_token = $.cookie("sweetpassword");

          $('#current_user').text("Hi, "+cur_user+" !");
          $('#login').hide(); 
        }else{
          $('#login').show();
        }

        $('.dropdown-toggle').dropdown();
        $('#loginBt').click(function(){
            
          $.ajax({
            type: "GET",
            url:"http://localhost/~janetyc/GumballServer/php/mobile/verifyUser.php",
            data: { "account": $('#account').val(), "password": $('#password').val() },
            dataType: 'json',
            success: function(data) {
                
              if(data["success"]==1){
                $.cookie("sweetuid", data["user_id"], 1);
                $.cookie("sweetaccount", data["account"] ,1);
                $.cookie("sweetpassword", data["token"], 1);

                $('#current_user').text("Hi, "+data["account"]+" !");
                $('#login').hide();
              }else{
                alert("No such user!");
              }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
              alert("Error");    
             }
          });
        });

        /* report submit */
        $('#reportSubmit').click(function(){
          $.ajax({
            type: "GET",
            url: "http://localhost/~janetyc/GumballServer/php/makeNewReport.php",
            data: { "user_id": cur_uid, "coordinate_x": "1", "coordinate_y": "1", "title": $('#problemInput').val()},
            
            dataType: 'json',
            success: function(data) {
              $('#problemInput').val("");
              /* update problem list*/
              readProblemList();
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
              alert("Error");
                
            }
          });
        });

        /* read exist problems */
        readProblemList();

        /* make machine icon draggable */
        $(".machine").draggable({
          cursor: 'move', 
          containment: 'document'}
        );


        /* update machine status every 2 sec */
        setInterval(function(){
          /*updateMachineStatus();*/
        }, 2000);


      });
    </script>

  </body>
</html>
