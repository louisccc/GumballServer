<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>SweetFeedback</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">

        <!-- Le styles -->
        <link href="assets/css/bootstrap.css" rel="stylesheet">
        <link href="assets/css/style.css" rel="stylesheet">
    
        <!--<link href="assets/css/docs.css" rel="stylesheet">-->
        <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">

        <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- Le fav and touch icons -->
        <link rel="shortcut icon" href="assets/ico/favicon.png">

    </head>

    <body>
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="#"><img src="img/logo.png" width="24px" id="logo"/>SweetFeedback</a>
                    <div class="nav-collapse">
                        <ul class="nav">
                            <li class="active"><a href="#">Home</a></li>
                            <li><a href="#about">About</a></li>
                            <li class="dropdown" id="login">
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#login">
                                    Login
                                    <b class="caret"></b>
                                </a>
                                <div class="dropdown-menu">
                                    <form>
                                        <fieldset class='textbox' style="padding:10px">
                                            <input id="account" style="margin-top: 8px" type="text" placeholder="Account" name="account"/>
                                            <input id="password" style="margin-top: 8px" type="password" placeholder="Passsword" name="password"/>
                                            <a class="btn btn-primary" id="loginBt">Log In</a>
                                        </fieldset>
                                    </form>
                                </div>
                            </li>
              
                            <li><a id="current_user"></a></li>
                        </ul>
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>

        <div class="container">
            <div class="tabable">
            <ul class="nav nav-pills spliter">
                <li class="active">
                    <a href="#apps-1" data-toggle="tab" id="app1">SB app</a>
                </li>
                <li class>
                    <a href="#apps-2" data-toggle="tab" id="app2">Trans app</a>
                </li>
                <li class>
                    <a href="#apps-3" data-toggle="tab" id="app3">Questionaire</a>
                </li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane active" id="apps-1">
                    <h1 class="title">Sustainability Base Building</h1>                                                                   
                        <div id="left">
                            <div class="building"><img src="img/building/building-1.png"/></div>
                            <img id="win_1" class="win" src="img/building/win1.png" style="margin-left: -486px; margin-top: 174px;"/>
                            <img id="win_2" class="win" src="img/building/win2.png" style="margin-left: -27px; margin-top: 143px;"/>
                            <img id="win_3" class="win" src="img/building/win3.png" style="margin-left: -25px; margin-top: 114px;"/>
                            <img id="win_4" class="win" src="img/building/win4.png" style="margin-left: -26px; margin-top: 85px;"/>
                            <img id="win_5" class="win" src="img/building/win5.png" style="margin-left: -26px; margin-top: 57px;"/>
                            <div class="building"><img src="img/building/building-2.png"/></div>
                        </div>
                        <div id="right">
                            <div id="report" class="modal hide fade">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h3>Report a Problem!</h3>
                                </div>
                                <div class="modal-body">
                                    <form>
                                        <fieldset class='textbox' style="padding:10px">
                                            <input id="problemInput" style="margin-top: 8px" type="text" placeholder="Problem"/>
                                            <a class="btn btn-primary" id="reportSubmit" data-dismiss="modal">Submit</a>
                                        </fieldset>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <a href="#" class="btn" data-dismiss="modal" >Close</a>
                                </div>
                            </div>
                            <a data-toggle="modal" href="#report" class="btn btn-primary">Report a Problem!</a>

                            <div id="problemArea">
                                <h4>Problem List</h4>
                            </div>    
                        </div>

                        <div class="machine" id="mrc_1">
                            <img class="mrc" src="img/mrc/mrc_happy.png" width="50px"/>
                            <img class="cold" src="img/others/char-cold.png" width="65px" style="margin-top: -155px; margin-left: -3px;"/>
                            <img class="sunglass" src="img/others/char-sunglass.png" width="65px" style="margin-top: -132px; margin-left: -6px;"/>
                            <img class="headphone" src="img/others/char-headphone.png" width="65px" style="margin-top: -200px; margin-left: -6px;"/>
                        </div>

                        <div class="machine" id="mrc_2">
                            <img class="mrc" src="img/mrc/mrc_happy.png" width="50px"/>
                            <img class="cold" src="img/others/char-cold.png" width="65px" style="margin-top: -155px; margin-left: -3px;"/>
                            <img class="sunglass" src="img/others/char-sunglass.png" width="65px" style="margin-top: -132px; margin-left: -6px;"/>
                            <img class="headphone" src="img/others/char-headphone.png" width="65px" style="margin-top: -200px; margin-left: -6px;"/>
                        </div>

                        <div class="machine" id="mrc_3">
                            <img class="mrc" src="img/mrc/mrc_happy.png" width="50px"/>
                            <img class="cold" src="img/others/char-cold.png" width="65px" style="margin-top: -155px; margin-left: -3px;"/>
                            <img class="sunglass" src="img/others/char-sunglass.png" width="65px" style="margin-top: -132px; margin-left: -6px;"/>
                            <img class="headphone" src="img/others/char-headphone.png" width="65px" style="margin-top: -200px; margin-left: -6px;"/>
                        </div>

                        <div class="machine" id="mrc_4">
                            <img class="mrc" src="img/mrc/mrc_happy.png" width="50px"/>
                            <img class="cold" src="img/others/char-cold.png" width="65px" style="margin-top: -155px; margin-left: -3px;"/>
                            <img class="sunglass" src="img/others/char-sunglass.png" width="65px" style="margin-top: -132px; margin-left: -6px;"/>
                            <img class="headphone" src="img/others/char-headphone.png" width="65px" style="margin-top: -200px; margin-left: -6px;"/>
                        </div>

                        <div class="machine" id="mrc_5">
                            <img class="mrc" src="img/mrc/mrc_happy.png" width="50px"/>
                            <img class="cold" src="img/others/char-cold.png" width="65px" style="margin-top: -155px; margin-left: -3px;"/>
                            <img class="sunglass" src="img/others/char-sunglass.png" width="65px" style="margin-top: -132px; margin-left: -6px;"/>
                            <img class="headphone" src="img/others/char-headphone.png" width="65px" style="margin-top: -200px; margin-left: -6px;"/>
                        </div>
                    </div>
              
                <div class="tab-pane" id="apps-2">   
                    <h1 class="title">Your Transportation Track</h1>                                                                   
                    <div id="left">
                        <div id="map_canvas"></div> 
                    </div>
                    <div id="right">
                        <div id="problemArea">
                            <h3>Description</h3>
                            <div id="descriptionList">
                                <ul class="items">
                                    <li>the red line represent you are biking</li>
                                    <li>the green line represent you are driving</li>
                                    <li>the yellow line represent you are walking</li>
                                    <li>other color represent you are train or other ways</li>
                                </ul>
                            </div>
                            <ul>
                            </ul>
                        </div>    
                    </div>
                </div>

                <div class="tab-pane" id="apps-3">
                <table>
                    <tr id="q1"><td class="quiz"><h4>1. In 2012, what anniversary did Carnegie Mellon Silicon Valley celebrate?</h4><br/>
                        a.    5th anniversary<br/>
                        b.    10th anniversary<br/>
                        c.    15th anniversary<br/>
                        d.    20th anniversary<br/>
                    <div style="color:green" id="cap_1" class="caption">CMUSV is 10 years old!</div></td>
                    <td class="tf" val="a">a</td>
                    <td class="tf" val="b">b</td>
                    <td class="tf" val="c">c</td>
                    <td class="tf" val="d">d</td></tr>

                    <tr id="q2"><td class="quiz"><h4>2. Who is the Director of the Silicon Valley campus?</h4><br/>
                        a.    Jared Cohon<br/>
                        b.    Mark Kamlet<br/>
                        c.    Martin Griss<br/>
                        d.    Jim Morris<br/>
                    <div style="color:green" id="cap_2" class="caption">Our director is Martin Griss. You get to meet him!</div></td>
                    <td class="tf" val="a">a</td>
                    <td class="tf" val="b">b</td>
                    <td class="tf" val="c">c</td>
                    <td class="tf" val="d">d</td></tr>
                    
                    <tr id="q3"><td class="quiz"><h4>3. What is the unique Carnegie Mellon Silicon Valley teaching style?</h4><br/>
                        a.    Lecture-based <br/>
                        b.    Learn-by-doing<br/>
                        c.    Remote classes<br/>
                        d.    Textbook-based<br/>
                    <div style="color:green" id="cap_3" class="caption">Learning by doing makes you perfect!</div></td>
                    <td class="tf" val="a">a</td>
                    <td class="tf" val="b">b</td>
                    <td class="tf" val="c">c</td>
                    <td class="tf" val="d">d</td></tr>

                    <tr id="q4"><td class="quiz"><h4>4. What is the Carnegie Mellon University motto?</h4><br/>
                        a.    "Knowledge is liberty." <br/>
                        b.    "Reach within, shape the future."<br/>
                        c.    "My heart is in the work."<br/>
                        d.    "Think. Grow. Change."<br/>
                    <div style="color:green" id="cap_4" class="caption">"My heart is in the work."</div></td>
                    <td class="tf" val="a">a</td>
                    <td class="tf" val="b">b</td>
                    <td class="tf" val="c">c</td>
                    <td class="tf" val="d">d</td></tr>

                    <tr id="q5"><td class="quiz"><h4>5. The CyLab Mobility Research Center was established to explore developments in </h4><br/>
                        a.    Mobile computing and networks<br/>
                        b.    Space travel <br/>
                        c.    Startups<br/>
                        d.    Public Transportation<br/>
                    <div style="color:green" id="cap_5" class="caption">Mobile computing and networks</div></td>
                    <td class="tf" val="a">a</td>
                    <td class="tf" val="b">b</td>
                    <td class="tf" val="c">c</td>
                    <td class="tf" val="d">d</td></tr>

                    <tr id="q6"><td class="quiz"><h4>6. Carnegie Mellon Silicon Valley shares its campus with</h4><br/>
                        a.    Google<br/>
                        b.    Microsoft<br/>
                        c.    U.S. Army<br/>
                        d.    NASA<br/>
                    <div style="color:green" id="cap_6" class="caption">National Aeronautics and Space Administration</div></td>
                    <td class="tf" val="a">a</td>
                    <td class="tf" val="b">b</td>
                    <td class="tf" val="c">c</td>
                    <td class="tf" val="d">d</td></tr>

                    <tr id="q7"><td class="quiz"><h4>7. What is the Carnegie Mellon University mascot?</h4><br/>
                        a.    Avalanche the Golden Bear<br/>
                        b.    Scotty the Scottie Dog<br/>
                        c.    Swoop the Red Hawk<br/>
                        d.    Thunder the Wolf<br/>
                    <div style="color:green" id="cap_7" class="caption">He is cute,isn't he?</div></td>
                    <td class="tf" val="a">a</td>
                    <td class="tf" val="b">b</td>
                    <td class="tf" val="c">c</td>
                    <td class="tf" val="d">d</td></tr>

                    <tr id="q8"><td class="quiz"><h4>8. How many students are currently enrolled at Carnegie Mellon Silicon Valley?</h4><br/>
                        a.    ~180<br/>
                        b.    ~250<br/>
                        c.    ~320<br/>
                        d.    ~380<br/>
                    <div style="color:green" id="cap_8" class="caption">Roughly 180</div></td>
                    <td class="tf" val="a">a</td>
                    <td class="tf" val="b">b</td>
                    <td class="tf" val="c">c</td>
                    <td class="tf" val="d">d</td></tr>

                    <tr id="q9"><td class="quiz"><h4>9. Which degree programs at CMUSV can also be taken part-time?</h4><br/>
                        a.    MS Software Engineering<br/>
                        b.    MS Software Management<br/>
                        c.    Ph.D. in Electrical and Computer Engineering<br/>
                        d.    a & b<br/>
                    <div style="color:green" id="cap_9" class="caption">MS Software Enginnering and MS software Management</div></td>
                    <td class="tf" val="a">a</td>
                    <td class="tf" val="b">b</td>
                    <td class="tf" val="c">c</td>
                    <td class="tf" val="d">d</td></tr>
                </table>
                <div id="result">
                    <div id="score">Your score is...<div id="score_num"></div><div id="comment"></div></div>
                </div>
                </div>
            </div>
        </div>

    <section id="monitor"></section>
    <section id="transportation"></section>



    </div> <!-- /container -->
                     
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap-transition.js"></script>
    <script src="assets/js/bootstrap-alert.js"></script>
    <script src="assets/js/bootstrap-modal.js"></script>
    <script src="assets/js/bootstrap-dropdown.js"></script>
    <script src="assets/js/bootstrap-scrollspy.js"></script>
    <script src="assets/js/bootstrap-tab.js"></script>
    <script src="assets/js/bootstrap-tooltip.js"></script>
    <script src="assets/js/bootstrap-popover.js"></script>
    <script src="assets/js/bootstrap-button.js"></script>
    <script src="assets/js/bootstrap-collapse.js"></script>
    <script src="assets/js/bootstrap-carousel.js"></script>
    <script src="assets/js/bootstrap-typeahead.js"></script>
    <script src="assets/js/jquery.cookie.js"></script>

    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyA3ieESIwbYV6OZC14fivVKoOSYvApTlh0&sensor=true"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script>

    

    <script language="javascript">
        function updateMachineStatus(){

            /* get sensor value*/
            $.ajax({
                type: "GET",
                url: "../php/getSensorValuesNew.php",
            
                dataType: 'json',
                success: function(data) {
                    $.each(data, function(i, item) {
                        var d_id = item['device_id'];
                        

                        
                        // light 
                        if(parseFloat(item['light_level']) >= 5.0){
                          $('#mrc_'+d_id+' img.sunglass').css("visibility", "show");
                        }else{
                          $('#mrc_'+d_id+' img.sunglass').css("visibility", "hidden");
                        }

                        // temperature
                        if(parseFloat(item['temperature']) >= 22.0){
                          $('#mrc_'+d_id+' img.cold').css("visibility", "hidden");
                        }else{
                          $('#mrc_'+d_id+' img.cold').css("visibility", "show");
                        }

                        // sound_level
                        if(parseFloat(item['sound_level']) >= 5.0){
                            $('#mrc_'+d_id+' img.headphone').css("visibility", "show");
                        }else{
                            $('#mrc_'+d_id+' img.headphone').css("visibility", "hidden");

                        }

                        //show machine
                        $('#mrc_'+d_id).show();
                    });
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert("Error");
                }
            });
        }
         
        function initMap() {
            var mapOptions = {
                center: new google.maps.LatLng(37, -122),
                zoom: 12,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            if(window.map != null){
                return;
            }
            window.map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

            $.getJSON("../php/mobile/getTripOfUser.php?token=5c1660554760cc76eee461ab79e57eb2", function(data){
                for(var i=0; i < data.length;i++){
                    var trip_id = data[i][0];
                    $.getJSON("../php/mobile/getUserTransportationData.php?token=5c1660554760cc76eee461ab79e57eb2&trip_id=" + trip_id, function(data){
                        var marker_array = [];
                        var label = data[0]['label'];

                        for(var i=0; i < data.length; i++){
                            marker_array.push(new google.maps.LatLng(data[i]['latitude'], data[i]['longitude']));
                            if( i == data.length - 1){
                                window.map.panTo(new google.maps.LatLng(data[data.length-1]['latitude'], data[data.length-1]['longitude']));
                            }
                        }

                        var color = "#FF0000";
                        //alert(label);
                        if (label == "driving car"){
                            color = "#00FF00";
                        }
                        else if(label == "train"){
                            color = "#0000FF";
                        }
                        else if(label == "walking"){
                            color = "#FFFF00";
                        }
                        var flight = new google.maps.Polyline({
                            path:  marker_array,
                            strokeColor: color,
                            strokeOpacity: 1.0,
                            strokeWeight: 2
                        });
                        flight.setMap(window.map);
                    });
                }
            });
            google.maps.event.trigger(window.map, 'resize');
        }

        function readProblemList(){

            /* clear problem list */
            $('#problemList').remove();
            $('#problemDetail').remove();
            var proList = $('<div></div>').attr('id','problemList');
            $('<ul></ul>').addClass('items').appendTo(proList);
            var proDetail = $('<div></div>').attr('id', 'problemDetail');
            $('#problemArea').append(proList);
            $('#problemArea').append(proDetail);
        
            /* get existing report */
            $.ajax({
                type: "GET",
                url: "../php/getExistReports.php",
                dataType: 'json',
                success: function(data) {

                    $.each(data, function(i, item) {
                        $('#problemList .items').append('<li><a data-toggle="modal" href="#problem_'+item.id+'">'+item.title+'</a></li>');
              
                        var problemDiv = $("<div></div>").attr('id','problem_'+item.id).addClass('modal hide fade');
                        var problemBody = $('<div></div>').addClass('modal-body').appendTo(problemDiv);
              
                        problemBody.append('<button type="button" class="close" data-dismiss="modal">&times;</button>');
                        problemBody.append("<h3>Problem: "+item.title+"</h3>");
                        problemBody.append('<span style="margin-left: 5px;">Create at '+item.created_at+'</span>');
                        problemDiv.append('<div class="modal-footer"><a href="#" class="btn fixIssue" data-dismiss="modal" id="problem_'+item.id+'"">Fixed it</a><a href="#" class="btn" data-dismiss="modal" >Close</a></div>');
                        problemDiv.appendTo('#problemDetail');

                    });
            
                    /* fix an existing report */
                    $('.fixIssue').click(function(){
                        var report = this.id.split('_');
                        $.ajax({
                            type: "GET",
                            url: "../php/makeFixReport.php",
                            data: { "user_id": window.cur_uid, "report_id": report[1] },
            
                            dataType: 'json',
                            success: function(data) {
                                readProblemList(); // update problem list
                            },
                            error: function(XMLHttpRequest, textStatus, errorThrown) {
                                alert("Error");
                            }
                        });
                    });
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert("Error");               
                }
            });
        }
        $(function(){

            /* hide headphone */
            $('.machine').hide(0);
            //$('.headphone').hide(0);
            $('.win').hide(0);

            /* log in stuff */
            window.cur_user = "test";
            window.cur_token;
            window.cur_uid = 0;
        
            if($.cookie("sweetpassword")!=null){
                window.cur_uid = $.cookie("sweetuid");
                window.cur_user = $.cookie("sweetaccount");
                window.cur_token = $.cookie("sweetpassword");

                $('#current_user').text("Hi, "+cur_user+" !");
                $('#login').hide(); 
            }else{
                $('#login').show();
            }

            $('.dropdown-toggle').dropdown();
            $('#loginBt').click(function(){
            
                $.ajax({
                    type: "GET",
                    url: "../php/mobile/verifyUser.php",
                    data: { "account": $('#account').val(), "password": $('#password').val() },
                    dataType: 'json',
                    success: function(data) {
                  
                        if(data["success"]==1){
                            $.cookie("sweetuid", data["user_id"], 1);
                            $.cookie("sweetaccount", data["account"] ,1);
                            $.cookie("sweetpassword", data["token"], 1);

                            $('#current_user').text("Hi, "+data["account"]+" !");
                            $('#login').hide();
                        }else{
                            alert("No such user!");
                        }
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        alert("Error");    
                    }
                });
            });
        
            /* make a new report */
            $('#reportSubmit').click(function(){
                $.ajax({
                    type: "GET",
                    url: "../php/makeNewReport.php",
                    data: { "user_id": window.cur_uid, "coordinate_x": "1", "coordinate_y": "1", "title": $('#problemInput').val()},
            
                    dataType: 'json',
                    success: function(data) {
                        $('#problemInput').val("");
                        readProblemList(); /* update problem list */
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        alert("Error");
                    }
                });
            });

            /* read exist problems */
            readProblemList();

            /* make machine icon draggable */
            $(".machine").draggable({
                cursor: 'move', 
                containment: 'document'}
            );
            $("#app2").click(function(){
                //google.maps.event.trigger(window.map, 'resize');
                initMap();
            });

            /* update machine status every 2 sec */
            setInterval(function(){
                updateMachineStatus();
            }, 2000);
        
        
            var correct_answers = ["b","c","b","c","a","d","b","a","d"];
            var answered = ["0","0","0","0","0","0","0","0","0"];
            var correct = 0;
            var count = 0;
            var standard = 100;
            var comment = new Array("", "", "OK...","Good!","Great!", "Excellent!!");
            $(".caption").hide(); 
            $(".tf").click(function() {
            
                // get question number, 0 ~ 4
                q_num = ($("tr").index($(this).parent()));

                // if not answered yet
                if (answered[q_num] == 0) {
           
                    // get answer
                    ans = $(this).attr("val");
            
                    // if correct, red
                    if (ans == correct_answers[q_num]) {
                        $(this).animate({backgroundColor:"#CCFFCC"}, 1000);
                        correct++;
                        count++;
                    } else {
                
                        //not correct, blue
                        $.post("../php/insertFeedback.php?application_id=9&type=negative");
                
                        $(this).animate({backgroundColor:"#FF8F8F"}, 1000);
                        count++;
                    }

                    // show the caption for the question
                    $("#cap_"+ (q_num+1)).fadeIn();
            
                    answered[q_num] = 1;
                    score = (100*correct/correct_answers.length);
                    if(score >= standard && count == correct_answers.length){
                        $.post("http://10.0.22.99/~fit/GumballServer/php/insertFeedback.php?application_id=9&type=positive");
                    }
                    $('#score_num').html(score.toFixed(1) + "%");
                    $('#comment').html(comment[Math.floor(correct/correct_answers.length*5)]);
                }
            });
        });
    </script>

    </body>
</html>
